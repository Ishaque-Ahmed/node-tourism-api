{"mappings":"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","sources":["public/js/alerts.js","public/js/login.js","public/js/leaflet.js","public/js/updateSettings.js","public/js/stripe.js","public/js/index.js"],"sourcesContent":["export const hideAlert = () => {\r\n    const el = document.querySelector('.alert');\r\n    if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\nexport const showAlert = (type, message, time = 5) => {\r\n    //type== success || error\r\n    hideAlert();\r\n    const markUp = `<div class=\"alert alert--${type}\">${message}</div`;\r\n    document.querySelector('body').insertAdjacentHTML('afterbegin', markUp);\r\n    window.setTimeout(hideAlert, time * 1000);\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nexport const login = async (email, password) => {\r\n    try {\r\n        const res = await axios({\r\n            method: 'POST',\r\n            url: '/api/v1/users/login',\r\n            data: {\r\n                email,\r\n                password,\r\n            },\r\n        });\r\n        if ((res.data.status = 'success')) {\r\n            showAlert('sucess', 'Logged In Successfully');\r\n            window.setTimeout(() => {\r\n                location.assign('/');\r\n            }, 1500);\r\n        }\r\n        console.log(res);\r\n    } catch (err) {\r\n        showAlert('error', err.response.data.message);\r\n    }\r\n};\r\nexport const logout = async (req, res) => {\r\n    try {\r\n        const res = await axios({\r\n            method: 'GET',\r\n            url: '/api/v1/users/logout',\r\n        });\r\n        if ((res.data.status = 'success')) {\r\n            location.reload(true);\r\n        }\r\n        // console.log(res);\r\n    } catch (err) {\r\n        console.log(err);\r\n        showAlert('error', 'Error Logging out, try Again');\r\n    }\r\n};\r\n","// const locations = JSON.parse(document.getElementById('map').dataset.locations);\r\n\r\nexport const displayMap = (locations) => {\r\n    var map = L.map('map', { zoomControl: false });\r\n\r\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n        attribution:\r\n            '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n    }).addTo(map);\r\n\r\n    const points = [];\r\n    locations.forEach((loc) => {\r\n        points.push([loc.coordinates[1], loc.coordinates[0]]);\r\n        L.marker([loc.coordinates[1], loc.coordinates[0]])\r\n            .addTo(map)\r\n            .bindPopup(`<p>Day ${loc.day}: ${loc.description}</p>`, {\r\n                autoClose: false,\r\n            })\r\n            .openPopup();\r\n    });\r\n\r\n    const bounds = L.latLngBounds(points).pad(0.5);\r\n    map.fitBounds(bounds);\r\n\r\n    map.scrollWheelZoom.disable();\r\n};\r\n","import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\n// type is either password or data\r\n// data => data object\r\nexport const updateSettins = async (data, type) => {\r\n    try {\r\n        const url =\r\n            type === 'password'\r\n                ? '/api/v1/users/updateMyPassword'\r\n                : '/api/v1/users/updateMe';\r\n        const res = await axios({\r\n            method: 'PATCH',\r\n            url,\r\n            data,\r\n        });\r\n        if ((res.data.status = 'success')) {\r\n            showAlert('success', `${type.toUpperCase()} Updated Succesfully`);\r\n            location.reload(true);\r\n        }\r\n        console.log(res);\r\n    } catch (err) {\r\n        showAlert('error', err.response.data.message);\r\n    }\r\n};\r\n","/* eslint-disable */\r\nimport axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nexport const bookTour = async (tourId) => {\r\n    try {\r\n        const stripe = Stripe(\r\n            'pk_test_51LcbSDImiZICFQHAutkboq45V5tGFHpTZlLtD7cbdXZjkcDsSSiCs5bShHVZ2ciXaN7ECmjhN6fsNPlfRIKVdJTb008AwvKmLG'\r\n        );\r\n        // 1) Get checkout session from API\r\n        const session = await axios(\r\n            `/api/v1/bookings/checkout-session/${tourId}`\r\n        );\r\n        console.log(session);\r\n\r\n        // 2) Create checkout form + chanre credit card\r\n        await stripe.redirectToCheckout({\r\n            sessionId: session.data.session.id,\r\n        });\r\n    } catch (err) {\r\n        console.log(err);\r\n        showAlert('error', err);\r\n    }\r\n};\r\n","import '@babel/polyfill';\r\nimport { login, logout } from './login';\r\nimport { displayMap } from './leaflet';\r\nimport { updateSettins } from './updateSettings';\r\nimport { bookTour } from './stripe';\r\nimport { showAlert } from './alerts';\r\n\r\n// DOM Elements\r\nconst leaflet = document.getElementById('map');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logoutBtn = document.querySelector('.nav__el--logout');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-password');\r\nconst bookBtn = document.getElementById('book-tour');\r\n\r\nif (leaflet) {\r\n    const locations = JSON.parse(leaflet.dataset.locations);\r\n    displayMap(locations);\r\n}\r\n\r\nif (loginForm) {\r\n    loginForm.addEventListener('submit', (e) => {\r\n        e.preventDefault();\r\n        const email = document.getElementById('email').value;\r\n        const password = document.getElementById('password').value;\r\n        login(email, password);\r\n    });\r\n}\r\nif (logoutBtn) {\r\n    logoutBtn.addEventListener('click', logout);\r\n}\r\nif (userDataForm) {\r\n    userDataForm.addEventListener('submit', (e) => {\r\n        e.preventDefault();\r\n        const form = new FormData();\r\n        form.append('name', document.getElementById('name').value);\r\n        form.append('email', document.getElementById('email').value);\r\n        form.append('photo', document.getElementById('photo').files[0]);\r\n        updateSettins(form, 'data');\r\n    });\r\n}\r\nif (userPasswordForm) {\r\n    userPasswordForm.addEventListener('submit', async (e) => {\r\n        e.preventDefault();\r\n        document.querySelector('.btn--save-password').textContent =\r\n            'Updating Password';\r\n        const passwordCurrent =\r\n            document.getElementById('password-current').value;\r\n        const password = document.getElementById('password').value;\r\n        const confirmPassword =\r\n            document.getElementById('password-confirm').value;\r\n        await updateSettins(\r\n            { passwordCurrent, password, confirmPassword },\r\n            'password'\r\n        );\r\n        document.querySelector('.btn--save-password').textContent =\r\n            'Save Password';\r\n        document.getElementById('password-current').value = '';\r\n        document.getElementById('password-confirm').value = '';\r\n        document.getElementById('password-confirm').value = '';\r\n    });\r\n}\r\nif (bookBtn)\r\n    bookBtn.addEventListener('click', (e) => {\r\n        e.target.textContent = 'Processing...';\r\n        const { tourId } = e.target.dataset;\r\n        bookTour(tourId);\r\n    });\r\n\r\nconst alertMsg = document.querySelector.body().dataset.alert;\r\nif (alertMsg) showAlert('success', alertMsg, 5);\r\n"],"names":["$1449e2aae815cef1$export$516836c6a9dfc573","el","document","querySelector","parentElement","removeChild","$1449e2aae815cef1$export$de026b00723010c1","type","message","time","markUp","insertAdjacentHTML","window","setTimeout","$670f245a287eee1a$export$596d806903d1f59e","async","email","password","res","$parcel$interopDefault","$7Gqth$axios","method","url","data","status","location","assign","console","log","err","response","$ee16711565208dc3$export$4c5dd147b21b9176","locations","map","L","zoomControl","tileLayer","attribution","addTo","points","forEach","loc","push","coordinates","marker","bindPopup","day","description","autoClose","openPopup","bounds","latLngBounds","pad","fitBounds","scrollWheelZoom","disable","$6d501e6a9597d2bd$export$8da9556efa08dfdf","toUpperCase","reload","$bf47579665d4523d$export$8d5bdbf26681c0c2","tourId","stripe","Stripe","session","redirectToCheckout","sessionId","id","$0a984acc79c38cfe$var$leaflet","getElementById","$0a984acc79c38cfe$var$loginForm","$0a984acc79c38cfe$var$logoutBtn","$0a984acc79c38cfe$var$userDataForm","$0a984acc79c38cfe$var$userPasswordForm","$0a984acc79c38cfe$var$bookBtn","JSON","parse","dataset","addEventListener","e","preventDefault","value","req","form","FormData","append","files","textContent","passwordCurrent","confirmPassword","target","$0a984acc79c38cfe$var$alertMsg","body","alert"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}